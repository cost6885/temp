<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ˆêµ¬ë¦¬ë¥¼ ê°€ì ¸ì™€</title>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #ffffff;
        }
        canvas {
            background: #ffd900;
        }

        #gameContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        
        #loadingScreen, #loadingScreen2 {
            text-align: center;
            font-size: 40px;
            position: fixed; /* í™”ë©´ ì „ì²´ë¥¼ ë®ë„ë¡ ì„¤ì • */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* ë°°ê²½ì„ ì–´ë‘¡ê²Œ */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000; /* ë‹¤ë¥¸ ìš”ì†Œë“¤ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì • */
        }

        #loadingScreen img, #loadingScreen2 img {
            width: 50%; /* í•„ìš”ì— ë”°ë¼ í¬ê¸°ë¥¼ ì¡°ì • */
            height: auto;
        }

        #loadingScreen p, #loadingScreen2 p {
            margin-top: 20px; /* í…ìŠ¤íŠ¸ì™€ ì´ë¯¸ì§€ ì‚¬ì´ì˜ ê°„ê²© */
        }

        #formContainer {
            text-align: center;
            font-size: 20px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding-top: 30px;    /* ìƒë‹¨ íŒ¨ë”© */
            padding-right: 20px;  /* ìš°ì¸¡ íŒ¨ë”© */
            padding-bottom: 30px; /* í•˜ë‹¨ íŒ¨ë”© */
            padding-left: 20px;   /* ì¢Œì¸¡ íŒ¨ë”© */
            width: 80%;           /* ë„ˆë¹„ ì¡°ì • */
            max-width: 600px;     /* ìµœëŒ€ ë„ˆë¹„ ì„¤ì • */
            border-radius: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: none;
        }

        .sendform {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 20px;
            margin: 8px 4px;
            cursor: pointer;
            border-radius: 12px;
            transition-duration: 0.4s;
        }
        .sendform:hover {
            background-color: white;
            color: black;
            border: 2px solid #4CAF50;
            cursor: pointer; /* ì†ê°€ë½ ëª¨ì–‘ ì»¤ì„œ */
        }

        
        #buttonContainer {
            position: absolute;
            top: 61%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 20px; /* ë²„íŠ¼ ì‚¬ì´ì˜ ê°„ê²© ì¡°ì • */
        }
        
        #startMessage, #exit {
            text-align: center;
            font-size: 24px;
            padding: 10px 20px; /* ì–‘ìª½ì— ì—¬ë°±ì„ ë” ì¶”ê°€í•˜ì—¬ ë²„íŠ¼ì´ ë” í¬ê³  ë‘êº¼ì›Œ ë³´ì´ê²Œ ë§Œë“­ë‹ˆë‹¤ */
            border-radius: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: none;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4); /* ë²„íŠ¼ ì•„ë˜ì— ê·¸ë¦¼ìë¥¼ ì¶”ê°€í•˜ì—¬ ë–  ìˆëŠ” ëŠë‚Œì„ ì¤ë‹ˆë‹¤ */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6); /* í…ìŠ¤íŠ¸ì— ê·¸ë¦¼ìë¥¼ ì¶”ê°€í•˜ì—¬ ì…ì²´ê°ì„ ì¤ë‹ˆë‹¤ */
            border: 2px solid #555; /* ì•½ê°„ ì–´ë‘ìš´ íšŒìƒ‰ í…Œë‘ë¦¬ë¥¼ ì¶”ê°€í•˜ì—¬ ë²„íŠ¼ì˜ ê²½ê³„ë¥¼ ê°•ì¡°í•©ë‹ˆë‹¤ */
            transition: all 0.3s ease; /* ë²„íŠ¼ì´ ìƒí˜¸ì‘ìš©í•  ë•Œ ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤ */
        }

        #startMessage:hover, #exit:hover {
            background-color: rgba(0, 0, 0, 0.9); /* í˜¸ë²„ ì‹œ ë²„íŠ¼ì´ ë” ì–´ë‘ì›Œì§€ë©° ê°•ì¡°ë©ë‹ˆë‹¤ */
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.5); /* ê·¸ë¦¼ì í¬ê¸°ë¥¼ í‚¤ì›Œ ë²„íŠ¼ì´ ë” ë–  ìˆëŠ” ëŠë‚Œì„ ì¤ë‹ˆë‹¤ */
            transform: translateY(-2px); /* ë²„íŠ¼ì´ ì‚´ì§ ìœ„ë¡œ ì´ë™í•˜ëŠ” íš¨ê³¼ë¥¼ ì¤ë‹ˆë‹¤ */
            cursor: pointer; /* ì»¤ì„œë¥¼ ì†ê°€ë½ ëª¨ì–‘ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ í´ë¦­ ê°€ëŠ¥í•œ ìš”ì†Œì„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤ */
        }


        #message {
            text-align: center;
            font-size: 18px;
            position: absolute;
            top: 90%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            border-radius: 10px;            
            color: black;
            font-weight: bold;
            font-family: 'Nanum Gothic', 'Malgun Gothic', sans-serif;
            display: none;
        }       
        

        #prepare {
            text-align: center;
            font-size: 24px;
            position: absolute;
            top: 74%; /* ì›í•˜ëŠ” ìœ„ì¹˜ë¡œ ì¡°ì • ê°€ëŠ¥ */
            left: 50%;
            transform: translateX(-50%); /* X ì¶•ìœ¼ë¡œë§Œ ì¤‘ì•™ ì •ë ¬ */
            padding: 10px;
            border-radius: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: none;
        }

        #startButton {
            text-align: center;
            font-size: 24px;
            position: absolute;
            top: 58%;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px; /* ì–‘ìª½ì— ì—¬ë°±ì„ ë” ì¶”ê°€í•˜ì—¬ ë²„íŠ¼ì´ ë” í¬ê³  ë‘êº¼ì›Œ ë³´ì´ê²Œ ë§Œë“­ë‹ˆë‹¤ */
            border-radius: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: none;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4); /* ë²„íŠ¼ ì•„ë˜ì— ê·¸ë¦¼ìë¥¼ ì¶”ê°€í•˜ì—¬ ë–  ìˆëŠ” ëŠë‚Œì„ ì¤ë‹ˆë‹¤ */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.6); /* í…ìŠ¤íŠ¸ì— ê·¸ë¦¼ìë¥¼ ì¶”ê°€í•˜ì—¬ ì…ì²´ê°ì„ ì¤ë‹ˆë‹¤ */
            border: 2px solid #555; /* ì•½ê°„ ì–´ë‘ìš´ íšŒìƒ‰ í…Œë‘ë¦¬ë¥¼ ì¶”ê°€í•˜ì—¬ ë²„íŠ¼ì˜ ê²½ê³„ë¥¼ ê°•ì¡°í•©ë‹ˆë‹¤ */
            transition: all 0.3s ease; /* ë²„íŠ¼ì´ ìƒí˜¸ì‘ìš©í•  ë•Œ ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ì„ ì¶”ê°€í•©ë‹ˆë‹¤ */
        }
        
        #startButton:hover {
            background-color: rgba(0, 0, 0, 0.9); /* í˜¸ë²„ ì‹œ ë²„íŠ¼ì´ ë” ì–´ë‘ì›Œì§€ë©° ê°•ì¡°ë©ë‹ˆë‹¤ */
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.5); /* ê·¸ë¦¼ì í¬ê¸°ë¥¼ í‚¤ì›Œ ë²„íŠ¼ì´ ë” ë–  ìˆëŠ” ëŠë‚Œì„ ì¤ë‹ˆë‹¤ */
            transform: translateX(-50%) translateY(-2px); /* ë²„íŠ¼ì´ ì‚´ì§ ìœ„ë¡œ ì´ë™í•˜ëŠ” íš¨ê³¼ë¥¼ ì¤ë‹ˆë‹¤ */
            cursor: pointer; /* ì»¤ì„œë¥¼ ì†ê°€ë½ ëª¨ì–‘ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ í´ë¦­ ê°€ëŠ¥í•œ ìš”ì†Œì„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤ */
        }

        #rankmore {
            text-align: center;
            font-size: 17px;
            position: absolute;
            top: 11%;
            left: 67%;
            transform: translateX(-50%);
            padding: 6px;
            border-radius: 30px;
            background-color: rgba(128, 0, 128, 0.7);
            color: white;
            z-index: 500;
            display: none;
        }

        #prepare:hover, #rankmore:hover {
            background-color: white;
            color: black;
            border: 2px solid #4CAF50;
            cursor: pointer; /* ì†ê°€ë½ ëª¨ì–‘ ì»¤ì„œ */
        }
        
       
        #gameDescription {
            text-align: center;
            font-size: 18px;
            position: absolute;
            top: 48%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding-top: 5px;
            padding-right: 20px;
            padding-bottom: 5px;
            padding-left: 20px;
            border-radius: 30px;
            display: none;
            background-color: rgba(255, 255, 255, 0.9);
            color: black;
            font-weight: bold;
            font-family: 'Nanum Gothic', 'Malgun Gothic', sans-serif;
        }

        
        #rankingBoard {
            text-align: center;
            font-size: 20px;
            position: absolute;
            top: 40%;
            left: 50%;            
            transform: translate(-50%, -50%);
            padding: 20px 20px; /* ìƒí•˜ ì¢Œìš° íŒ¨ë”©ì„ ê°ê° 20pxê³¼ 40pxë¡œ ì„¤ì • */
            border-radius: 10px;
            display: none;
            background-color: rgba(255, 255, 0, 0.5);
            color: black;
            font-weight: bold;
            font-family: 'Nanum Gothic', 'Malgun Gothic', sans-serif;
            line-height: 1.6; /* ì¤„ ê°„ê²© ì¡°ì ˆ */
            width: 80%; /* í™”ë©´ í¬ê¸°ì˜ 80%ë¡œ ì„¤ì • */
            max-width: 440px; /* ìµœëŒ€ ê°€ë¡œ í¬ê¸° ì„¤ì • (ì˜ˆ: 1000px) */
        }
        
        .styled-button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 8px 4px;
            cursor: pointer;
            border-radius: 12px;
            transition-duration: 0.4s;
        }
        .styled-button:hover {
            background-color: white;
            color: black;
            border: 2px solid #4CAF50;
            cursor: pointer; /* ì†ê°€ë½ ëª¨ì–‘ ì»¤ì„œ */
        }
        
        .game-start {
            margin-bottom: 32px; /* ê²Œì„ ì‹œì‘ ë¬¸êµ¬ ì•„ë˜ì— ì—¬ë°± ì¶”ê°€ */
        }
        .ranking-section {
            margin-top: 16px; 
        }
        #characterSelection, #difficultySelection {
            display: none;
            text-align: center;
            margin-top: 0px;
        }

        .character-option {
            margin: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 10px;
            transition: border-color 0.3s;
            width: 100px; /* ì´ë¯¸ì§€ ë„ˆë¹„ ì¡°ì • */
            height: auto; /* ìë™ ë†’ì´ ì¡°ì • */
        }

        .character-option:hover, .difficulty-option:hover {
            border-color: blue;
            cursor: pointer; /* ì†ê°€ë½ ëª¨ì–‘ ì»¤ì„œ */
        }

        .selected {
            border: 2px solid red;
        }
        
        #audioControls {
            position: fixed;
            top: 20px; /* í™”ë©´ ì¤‘ì•™ì—ì„œ ìº”ë²„ìŠ¤ ë†’ì´ì˜ ì ˆë°˜ê³¼ ë²„íŠ¼ ìœ„ì¹˜ë¥¼ ì¡°ì • */
            right: calc(50% - 320px); /* í™”ë©´ ì¤‘ì•™ì—ì„œ ìº”ë²„ìŠ¤ ë„ˆë¹„ì˜ ì ˆë°˜ì„ ì¡°ì • */
            display: flex;
            flex-direction: column; /* ë²„íŠ¼ë“¤ì„ ìœ„ì•„ë˜ë¡œ ë°°ì¹˜ */
            gap: 10px; /* ë²„íŠ¼ ì‚¬ì´ì˜ ê°„ê²©ì„ 10pxë¡œ ì„¤ì • (í•„ìš”ì— ë”°ë¼ ì¡°ì • ê°€ëŠ¥) */
        }
 

        .difficulty-container {
            display: flex;
            justify-content: center; /* ì¤‘ì•™ ì •ë ¬ */
            gap: 10px; /* ë²„íŠ¼ ì‚¬ì´ì˜ ê°„ê²© */
        }

        #challengeButton {            
            background-color: red; /* ì‹œë»˜ê±´ìƒ‰ */
        }

        #challengeButton:hover {            
            background-color: white; /* ì‹œë»˜ê±´ìƒ‰ */
            border-color: blue;
            cursor: pointer; /* ì†ê°€ë½ ëª¨ì–‘ ì»¤ì„œ */
        }

        #company {
            width: 177px !important;
            font-size: 13.3px;
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }


        /* íŠ¹ìˆ˜ ì„±ê³µ ìƒíƒœì¼ ë•Œì˜ ìŠ¤íƒ€ì¼ */
        .success-drawn {
            background-color: #28a745; /* ì„±ê³µì„ ë‚˜íƒ€ë‚´ëŠ” ë…¹ìƒ‰ ë°°ê²½ */
            top: 69%;
            color: white; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3); /* ê·¸ë¦¼ìë¥¼ ì¶”ê°€í•˜ì—¬ ë–  ìˆëŠ” ëŠë‚Œì„ ì¤ë‹ˆë‹¤ */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5); /* í…ìŠ¤íŠ¸ì— ê·¸ë¦¼ìë¥¼ ì¶”ê°€í•˜ì—¬ ì…ì²´ê°ì„ ì¤ë‹ˆë‹¤ */
            border: 2px solid #1e7e34; /* ì•½ê°„ ì–´ë‘ìš´ ë…¹ìƒ‰ í…Œë‘ë¦¬ë¥¼ ì¶”ê°€ */
            transition: all 0.3s ease; /* ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜ */
        }
        
                
    </style>
</head>
<body>
    <div id="gameDescription">
        <p>ê³¼ì—° ë„ˆêµ¬ë¦¬ì”¨ğŸ¦ëŠ” ë¼ë©´ë“¤ì„ ê°€ì§€ê³ </p>
        <p>ì €ë…ì‹ì‚¬ ì‹œê°„â± ì „ì— ëŒì•„ ê°ˆ ìˆ˜ ìˆì„ê¹Œìš”?</p>
        <p>ë‹¨ì§ì¹œêµ¬ ë‹¤ì‹œë§ˆë“¤ì´ ë„ì™€ì¤„í…Œë‹ˆ ë„ˆë¬´ ê±±ì •ë§ˆì„¸ìš”^^</p>
        <p>Tipâ— ê°€ë”ì”© ë–¨ì–´ì§€ëŠ” ìŠ¤í”„ ë¨¹ê¸°</p>
        <p class="game-start">'ì¤€ë¹„í•˜ê¸°' ë²„íŠ¼ì„ í´ë¦­ğŸ‘†í•˜ì„¸ìš”.</p> <!-- ì—¬ë°± ì¶”ê°€ -->
        <p class="ranking-section">ğŸ†ë­í‚¹ 1ë“±ğŸ† ë„ˆêµ¬ë¦¬ ë©€í‹°íŒ©(40ì…)</p>
        <p>ğŸ¥‡ë­í‚¹ 2ë“±ğŸ¥‡ ë„ˆêµ¬ë¦¬ì»µ(30ì…)</p>
        <p>ğŸ¥ˆë­í‚¹ 3ë“±ğŸ¥ˆ ì¹´êµ¬ë¦¬í°ì‚¬ë°œ(16ì…)</p>
        <p>ğŸ‘¥ì°¸ì—¬ì ì¶”ì²¨(7ëª…)ğŸ‘¥ ëˆ„ë“¤í• ì¹´êµ¬ë¦¬ë§›(8ì…)</p>
        <p>ğŸ‘€ì¤‘ë³µ ë‹¹ì²¨ ë¶ˆê°€ğŸ‘€</p>
    </div>
    
    <div id="formContainer">
        <label>íšŒì‚¬: 
            <select id="company">
                <option value="">íšŒì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                <option value="ë†ì‹¬">ë†ì‹¬</option>
                <option value="ë†ì‹¬íƒœê²½">ë†ì‹¬íƒœê²½</option>
                <option value="ìœ¨ì´Œí™”í•™">ìœ¨ì´Œí™”í•™</option>
                <option value="ë©”ê°€ë§ˆíŠ¸">ë©”ê°€ë§ˆíŠ¸</option>
                <option value="ë†ì‹¬ì—”ì§€ë‹ˆì–´ë§">ë†ì‹¬ì—”ì§€ë‹ˆì–´ë§</option>
                <option value="ì—”ë””ì—ìŠ¤">ì—”ë””ì—ìŠ¤</option>
                <option value="ë†ì‹¬ë¯¸ë¶„">ë†ì‹¬ë¯¸ë¶„</option>
                <option value="í˜¸í…”ë†ì‹¬">í˜¸í…”ë†ì‹¬</option>
                <option value="ë†ì‹¬í™€ë”©ìŠ¤">ë†ì‹¬í™€ë”©ìŠ¤</option>
                <option value="ë†ì‹¬ìºí”¼íƒˆ">ë†ì‹¬ìºí”¼íƒˆ</option>
                <option value="ì´ìŠ¤í„´ì›°ìŠ¤">ì´ìŠ¤í„´ì›°ìŠ¤</option>
                <option value="ë‰´í…Œë¼ë‹‰ìŠ¤">ë‰´í…Œë¼ë‹‰ìŠ¤</option>
                <option value="ì—”ì—ìŠ¤ì•„ë¦¬ì•„">ì—”ì—ìŠ¤ì•„ë¦¬ì•„</option>
                <option value="ë†ì‹¬ê°œë°œ">ë†ì‹¬ê°œë°œ</option>
                <option value="ìœ¨ì´Œì¬ë‹¨">ìœ¨ì´Œì¬ë‹¨</option>
                <option value="ìºì²˜ìŠ¤">ìºì²˜ìŠ¤</option>
                <option value="ë†ì‹¬ì´ìŠ¤í¬ì¸ ">ë†ì‹¬ì´ìŠ¤í¬ì¸ </option>
            </select>
        </label><br>
        <label>ì‚¬ë²ˆ: <input type="text" id="employeeId"></label><br>
        <label>ì´ë¦„: <input type="text" id="name"></label><br>
        <button class="sendform" onclick="sendToGoogleSheets()">ì‘ëª¨í•˜ê¸°</button>
        <button class="sendform" onclick="prapare()">ë‹¤ì‹œí•˜ê¸°</button>
    </div>

    
    <div id="loadingScreen">
        <div>
            <img src="https://github.com/cost6885/tbon2/raw/main/image/loading2.gif" alt="Loading...">
            <p>ë¡œë”© ì¤‘...</p>
        </div>
    </div>

        <div id="loadingScreen2">
        <div>
            <img src="https://github.com/cost6885/tbon2/raw/main/image/loading3.webp" alt="Loading...">
            <p>ë­í‚¹ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </div>

    <canvas id="gameCanvas" width="640" height="600"></canvas>
        
    <div id="gameContainer">    
        <div id="characterSelection">
            <h3>ìºë¦­í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
            <img src="https://github.com/cost6885/tbon2/raw/main/image/racoon1.gif" class="character-option" onclick="selectCharacter('https://github.com/cost6885/tbon2/raw/main/image/racoon1.gif')">
            <img src="https://github.com/cost6885/tbon2/raw/main/image/racoon2.gif" class="character-option" onclick="selectCharacter('https://github.com/cost6885/tbon2/raw/main/image/racoon2.gif')">
            <img src="https://github.com/cost6885/tbon2/raw/main/image/racoon5.gif" class="character-option" onclick="selectCharacter('https://github.com/cost6885/tbon2/raw/main/image/racoon5.gif')">
            <img src="https://github.com/cost6885/tbon2/raw/main/image/racoon6.gif" class="character-option" onclick="selectCharacter('https://github.com/cost6885/tbon2/raw/main/image/racoon6.gif')">
        </div>
    
        <div id="difficultySelection">
            <h3>ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
            <div class="difficulty-container">
                <button class="difficulty-option styled-button" onclick="selectDifficulty('ì‰¬ì›€')">ì‰¬ì›€</button>
                <button class="difficulty-option styled-button" onclick="selectDifficulty('ì–´ë ¤ì›€')">ì–´ë ¤ì›€</button>
                <button id="challengeButton" class="difficulty-option styled-button" style="display: none;" onclick="selectDifficulty('ë„ì „')">ë„ì „</button>
            </div>
        </div>
    </div>

    <div id="buttonContainer">
        <div id="startMessage" onclick="prapare()">ë‹¤ì‹œí•˜ê¸°ğŸ”„</div>
        <div id="exit" onclick="closeWindow()">ë‚˜ê°€ê¸°ğŸšª</div>
    </div>   

    <div id="message"></div>

    <button id="rankmore" onclick="rankmore()">ë”ë³´ê¸°â‹¯</button>
    
    <div id="rankingBoard"></div>

    <button id="prepare" onclick="prapare()">ì¤€ë¹„í•˜ê¸°</button>


    <div id="startButtonContainer">
        <button id="startButton" onclick="startGame()">ê²Œì„ ì‹œì‘</button>
    </div>

    <div id="audioControls">
        <button onclick="playAudio()">BGM ONğŸ”Š</button>        
        <button onclick="pauseAudio()">BGM OFFğŸ”ˆ</button>
    </div>

    <!-- BGM ì¶”ê°€ -->
    <audio id="bgm" loop>
        <source src="https://firebasestorage.googleapis.com/v0/b/driven-cabinet-381405.appspot.com/o/%5BRoyalty%20Free%20Music%5D%20Ponpoko%20(8bit%20game%20retro).mp3?alt=media&token=d99399f7-fd8f-4d65-87bd-0c70ffc37bf3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- ë‚™í•˜ì•„ì´í…œ ì¶”ê°€ -->
    <img id="fallingItem" src="https://github.com/cost6885/tbon2/raw/main/image/soup2.png" style="display: none; position: absolute; width: 80px; height: 70px;" alt="Falling Item">
    

    <script>

        var defaultCharacter = 'https://github.com/cost6885/tbon2/raw/main/image/racoon1.gif';

        var totalItems;        

        var item, itemX, itemY, itemFalling = false, itemCaught = false, itemStock = false;

        var itemHeight = 108; // ì•„ì´í…œ ë†’ì´ ì •ì˜
        var itemWidth = 100; // ì•„ì´í…œ ë„ˆë¹„ ì •ì˜
        var fallingItem = document.getElementById('fallingItem'); // ë–¨ì–´ì§€ëŠ” ì•„ì´í…œ ì´ë¯¸ì§€
        var fallingItemData = null; // ë–¨ì–´ì§€ëŠ” ì•„ì´í…œ ë°ì´í„° ì´ˆê¸°í™”        
        
        var canvas, ctx, ballRadius = 10, x, y, dx = 6, dy = -6, paddleHeight = 47, paddleWidth = 133, paddleX;
        var rightPressed = false, leftPressed = false;
        var brickRowCount = 2, brickColumnCount = 6, brickWidth = 100, brickHeight = 108, brickPadding = 0, brickOffsetTop = 20, brickOffsetLeft = 20;
        var bricks = [], score = 0, gameStarted = false, startTime, elapsedTime;
        var brickImage, image, canvasImage;
        var enlargedBallRadius = ballRadius * 5;
        var ballImage = new Image();
        var characterSelected = false;
        var difficultySelected = false;
        var difficulty = 'easy';
        var audio = document.getElementById('bgm');
        var isDragging = false;
        var gamecount = 0
        ballImage.src = defaultCharacter;

        document.addEventListener("DOMContentLoaded", function() {

            document.getElementById("loadingScreen2").style.display = "none";
            
            showLoadingScreen();
            canvas = document.getElementById("gameCanvas");
            ctx = canvas.getContext("2d");

            document.addEventListener("keydown", keyDownHandler);
            document.addEventListener("keyup", keyUpHandler);
            canvas.addEventListener("mousedown", mouseDownHandler);
            canvas.addEventListener("mouseup", mouseUpHandler);
            canvas.addEventListener("mousemove", mouseMoveHandler);
            canvas.addEventListener("touchstart", touchStartHandler);
            canvas.addEventListener("touchend", touchEndHandler);
            canvas.addEventListener("touchmove", touchMoveHandler);            
            
            brickImage = new Image();
            brickImage.src = "https://github.com/cost6885/tbon2/raw/main/image/block.png";

            canvasImage = new Image();
            canvasImage.src = 'https://github.com/cost6885/tbon2/raw/main/image/ramenbg.jpg';

            canvasImage.onload = function() {
                ctx.globalAlpha = 0.9;
                ctx.drawImage(canvasImage, 0, 0, canvas.width, canvas.height);
                ctx.globalAlpha = 1;
                hideLoadingScreen();                
                showStartButton();
                            
                audio.play().catch(function(error) {
                    // ìë™ ì¬ìƒ ì‹¤íŒ¨ ì‹œ, ì‚¬ìš©ì ìƒí˜¸ì‘ìš©ì„ ê¸°ë‹¤ë¦¼
                    console.log('Auto-play prevented by browser:', error);
                });
            };

            brickImage.onload = function() {
                // Brick image ë¡œë“œ í›„ ì‘ì—…ì´ í•„ìš”í•œ ê²½ìš° ì—¬ê¸°ì— ì‘ì„±
            };

            ballImage.onload = function() {
                // Ball image ë¡œë“œ í›„ ì‘ì—…ì´ í•„ìš”í•œ ê²½ìš° ì—¬ê¸°ì— ì‘ì„±
            };
        });



        function startItemFall(brickX, brickY) {
            itemFalling = true;
            itemCaught = false;
            itemStock = false;
        
            // ìº”ë²„ìŠ¤ì˜ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜´
            var canvasRect = canvas.getBoundingClientRect();
        
            // ì•„ì´í…œ ìœ„ì¹˜ë¥¼ ìº”ë²„ìŠ¤ ê¸°ì¤€ìœ¼ë¡œ ì¡°ì •
            itemX = canvasRect.left + brickX + brickWidth / 2 - itemWidth / 2;
            itemY = canvasRect.top + brickY;
        
            item = document.getElementById('fallingItem'); // ì•„ì´í…œ ì´ë¯¸ì§€ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
            item.style.position = "absolute";
            item.style.left = itemX + "px";
            item.style.top = itemY + "px";
            item.style.display = "block";
        }


        function updateItemFall() {
            if (itemFalling) {
                itemY += 5; // ì•„ì´í…œì˜ ë‚™í•˜ ì†ë„
        
                // ìº”ë²„ìŠ¤ì˜ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜´
                var canvasRect = canvas.getBoundingClientRect();
        
                // ì•„ì´í…œ ìœ„ì¹˜ë¥¼ ìº”ë²„ìŠ¤ ê¸°ì¤€ìœ¼ë¡œ ì¡°ì •
                var relativeItemX = itemX - canvasRect.left;
                var relativeItemY = itemY - canvasRect.top;
        
                item.style.left = itemX + "px";
                item.style.top = itemY + "px";
        
                // íŒ¨ë“¤ê³¼ ì¶©ëŒ ì²´í¬ (ìº”ë²„ìŠ¤ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°)
                if (relativeItemY + itemHeight > canvas.height - paddleHeight - 10 && relativeItemY + itemHeight < canvas.height) {
                    // íŒ¨ë“¤ì˜ ì „ì²´ ì˜ì—­ê³¼ ì¶©ëŒ ì²´í¬
                    if (relativeItemX + itemWidth > paddleX && relativeItemX < paddleX + paddleWidth) {
                        itemFalling = false;
                        itemStock = true;
                        item.style.display = "none";
                        
                        // ìƒˆë¡œìš´ ì´ë¯¸ì§€ ê°ì²´ ìƒì„±
                        var newBallImage = new Image();
                        newBallImage.src = 'https://github.com/cost6885/tbon2/raw/main/image/racoon7.png'; // ë„ˆêµ¬ë¦¬ í‘í™”
                        
                        // ì´ë¯¸ì§€ê°€ ë¡œë“œëœ í›„ì— ë¸”ëŸ­ ë¬´ì‹œ íš¨ê³¼ ì ìš©
                        newBallImage.onload = function() {
                            ballImage.src = newBallImage.src;
                            itemCaught = true;  // ì´ë¯¸ì§€ê°€ ë³€ê²½ëœ í›„ì— ë¸”ëŸ­ ë¬´ì‹œ íš¨ê³¼ ë°œìƒ
                        };
        
                        return; // ì¶©ëŒ ì‹œ ì¦‰ì‹œ í•¨ìˆ˜ ì¢…ë£Œ
                    }
                }
        
                // ì•„ì´í…œì´ ë°”ë‹¥ì— ë„ë‹¬í–ˆì„ ë•Œ
                if (relativeItemY + itemHeight >= canvas.height) {
                    itemFalling = false;
                    item.style.display = "none"; // ì•„ì´í…œì´ ì‚¬ë¼ì§€ê²Œ ì²˜ë¦¬
                }
            }
        }


        
        

        function closeWindow() {
            window.close();
        }
        
        function playAudio() {
            audio.play();
        }

        function pauseAudio() {
            audio.pause();
            audio.currentTime = 0;  // ì¬ìƒ ìœ„ì¹˜ë¥¼ ì²˜ìŒìœ¼ë¡œ ëŒë¦¼
        }            
                
        function prapare() {
            document.getElementById("gameDescription").style.display = 'none';
            document.getElementById("formContainer").style.display = "none";
            document.getElementById("message").style.display = "none";
            document.getElementById("gameCanvas").style.display = "none";
            document.getElementById("startMessage").style.display = "none";
            document.getElementById("prepare").style.display = "none";
            document.getElementById("exit").style.display = "none";
            document.getElementById("characterSelection").style.display = "block";
            document.getElementById("difficultySelection").style.display = "block";
            document.getElementById("rankmore").style.display = "block";
            
            // ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
            characterSelected = false;
            difficultySelected = false;

            // ìºë¦­í„°ì™€ ë‚œì´ë„ì— ì„ íƒëœ í…Œë‘ë¦¬ ì œê±°
            document.querySelectorAll('.character-option').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.difficulty-option').forEach(el => el.classList.remove('selected'));
            
        
            // gameContainerë¥¼ ì•„ë˜ë¡œ ë‚´ë¦¬ê¸° ìœ„í•œ ì½”ë“œ ì¶”ê°€
            var gameContainer = document.getElementById("gameContainer");
            gameContainer.style.position = "relative"; // position ì†ì„± ì„¤ì •
            gameContainer.style.top = "300px"; // ì•„ë˜ë¡œ 300px ì´ë™
        
            // ë­í‚¹ ë³´ë“œì˜ ìœ„ì¹˜ë¥¼ ìœ„ë¡œ ì˜¬ë¦¬ê¸°
            var rankingBoard = document.getElementById("rankingBoard");
            rankingBoard.style.position = "absolute"; // ìœ„ì¹˜ ì„¤ì •ì„ ìœ„í•´ position ì†ì„± ì¶”ê°€
            rankingBoard.style.top = "30%"; // ë­í‚¹ ë³´ë“œë¥¼ í™”ë©´ì—ì„œ 30% ìœ„ì¹˜ë¡œ ì´ë™       
        
            // ë­í‚¹ ë³´ë“œê°€ ì´ë¯¸ í‘œì‹œë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
            if (rankingBoard.style.display !== "block") {
                // ë­í‚¹ ë³´ë“œë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ í˜¸ì¶œ
                displayLocalRankingBoard();
                rankingBoard.style.display = "block"; // ë­í‚¹ ë³´ë“œë¥¼ í•­ìƒ í‘œì‹œ
            }           
                        
            checkStartCondition();
        }




        function selectCharacter(src) {
            ballImage.src = src;
            characterSelected = true;
            document.querySelectorAll('.character-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            checkStartCondition();
        }


        function selectDifficulty(level) {
            difficulty = level;
            difficultySelected = true;
            document.querySelectorAll('.difficulty-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            checkStartCondition();
        }

        function checkStartCondition() {
            if (characterSelected && difficultySelected) {
                document.getElementById('startButton').style.display = 'block';
            }
            if (gamecount >= 3) {
                document.getElementById('challengeButton').style.display = 'inline-block';
            }
        }
        
        function showLoadingScreen() {
            document.getElementById("loadingScreen").style.display = "flex";
        }

        function hideLoadingScreen() {
            document.getElementById("loadingScreen").style.display = "none";
        }

        function showStartButton() {
            document.getElementById('prepare').style.display = 'block';
            document.getElementById('gameDescription').style.display = 'block';
        }

        function drawBackground() {
            ctx.globalAlpha = 0.3; // íˆ¬ëª…ë„ ì„¤ì • (0.0ì—ì„œ 1.0 ì‚¬ì´ ê°’)
            ctx.drawImage(canvasImage, 0, 0, canvas.width, canvas.height);  // ë°°ê²½ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
            ctx.globalAlpha = 1.0; // íˆ¬ëª…ë„ ì›ë˜ëŒ€ë¡œ ëŒë¦¬ê¸°
        }
        
        function initGame() {
            console.log("Initializing game...");
            x = canvas.width / 4; // ê³µì˜ ì´ˆê¸° ìœ„ì¹˜ë¥¼ ìº”ë²„ìŠ¤ì˜ 3ë¶„ì˜ 1 ì§€ì ìœ¼ë¡œ ì„¤ì •
            y = canvas.height - paddleHeight - enlargedBallRadius; // íŒ¨ë“¤ ìœ„ë¡œ ê³µì˜ ì´ˆê¸° ìœ„ì¹˜ ì„¤ì •
            dx = 5;
            dy = -5;
            paddleX = (canvas.width - paddleWidth) / 3; // íŒ¨ë“¤ì˜ ì´ˆê¸° ìœ„ì¹˜ë¥¼ ìº”ë²„ìŠ¤ì˜ 3ë¶„ì˜ 1 ì§€ì ìœ¼ë¡œ ì„¤ì •
        
            bricks = [];
            for (var c = 0; c < brickColumnCount; c++) {
                bricks[c] = [];
                for (var r = 0; r < brickRowCount; r++) {
                    bricks[c][r] = { x: 0, y: 0, status: 1 };
                }
            }
        
            score = 0;            
            itemCaught = false; // íŠ¹ìˆ˜ ëª¨ë“œ ì´ˆê¸°í™”
            document.getElementById("fallingItem").style.display = "none";
            document.getElementById("message").style.display = "none";
            document.getElementById("startMessage").style.display = "none";
            document.getElementById('prepare').style.display = 'none';
            document.getElementById("characterSelection").style.display = "none";
            document.getElementById("rankmore").style.display = "none";
            gameStarted = false; // Ensure gameStarted is reset
            elapsedTime = 0;
            totalItems = Math.floor(Math.random() * 5) + 1; // ì´ ì•„ì´í…œ ìˆ˜ 1~5 ì‚¬ì´ë¡œ ì„¤ì •
            fallingItemData = null; // ì•„ì´í…œ ë°ì´í„° ì´ˆê¸°í™”            
            console.log("Game initialized.");
        }


        function keyDownHandler(e) {
            if (e.key === "Right" || e.key === "ArrowRight") {
                rightPressed = true;
            } else if (e.key === "Left" || e.key === "ArrowLeft") {
                leftPressed = true;
            } else if (e.key === " " && successMessageShown) {
                document.getElementById("startMessage").style.display = "none";
                prapare();  // initGame() ëŒ€ì‹  prepare() í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì¤€ë¹„ ìƒíƒœë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.
                successMessageShown = false; // ë©”ì‹œì§€ê°€ ìˆ¨ê²¨ì¡ŒìŒì„ í‘œì‹œ
            }
        }

        function keyUpHandler(e) {
            if (e.key === "Right" || e.key === "ArrowRight") {
                rightPressed = false;
            } else if (e.key === "Left" || e.key === "ArrowLeft") {
                leftPressed = false;
            }
        }

        function mouseDownHandler(e) {
            isDragging = true;
        }
        
        function mouseUpHandler(e) {
            isDragging = false;
        }
        
        function mouseMoveHandler(e) {
            if (isDragging) {
                var relativeX = e.clientX - canvas.offsetLeft;
                if (relativeX > 0 && relativeX < canvas.width) {
                    paddleX = relativeX - paddleWidth / 2;
                }
            }
        }
        
        function touchStartHandler(e) {
            isDragging = true;
        }
        
        function touchEndHandler(e) {
            isDragging = false;
        }
        
        function touchMoveHandler(e) {
            if (isDragging) {
                var touch = e.touches[0];
                var relativeX = touch.clientX - canvas.offsetLeft;
                if (relativeX > 0 && relativeX < canvas.width) {
                    paddleX = relativeX - paddleWidth / 2;
                }
            }
        }

        
        function drawSuccessMessage() {
            console.log("Drawing success message...");
            ctx.fillStyle = "black";
            ctx.font = "24px Arial";
            ctx.textAlign = "center";
            ctx.fillText(`ì„±ê³µ! ${elapsedTime}ì´ˆ`, canvas.width / 2, canvas.height / 2 - 20); // í™”ë©´ ì¤‘ì•™ì— ë©”ì‹œì§€ ì¶œë ¥
        
            // Calculate and store elapsed time
            var endTime = Date.now();
            elapsedTime = ((endTime - startTime) / 1000).toFixed(2);
            localStorage.setItem("elapsedTime", elapsedTime);
        
            // ìƒˆë¡œìš´ ê¸°ë¡ì„ ì €ì¥
            var name = localStorage.getItem("name") || "Unknown";
            var newEntry = { name: name, elapsedTime: parseFloat(elapsedTime) };
            saveLocalRanking(newEntry);        
        
            // Display event application form and button
            document.getElementById("formContainer").style.display = "block";
            document.getElementById("message").style.display = "block";
            
            var messageElement = document.getElementById("message");
            messageElement.style.display = "block";
            messageElement.innerText = `ì„±ê³µ! ${elapsedTime}ì´ˆ`;
        
            successMessageShown = true;
            console.log("Success message drawn.");
        }


        function drawBall() {
            ctx.drawImage(ballImage, x - enlargedBallRadius, y - enlargedBallRadius, enlargedBallRadius * 2, enlargedBallRadius * 2);
        }


        var paddleImage = new Image();    
        paddleImage.src = "https://github.com/cost6885/tbon2/raw/main/image/dasima.png";


        function drawPaddle() {
            ctx.drawImage(paddleImage, paddleX, canvas.height - paddleHeight - 10, paddleWidth, paddleHeight);
        }

        function drawBricks() {
            for (var c = 0; c < brickColumnCount; c++) {
                for (var r = 0; r < brickRowCount; r++) {
                    if (bricks[c][r].status == 1) {
                        var brickX = c * (brickWidth + brickPadding) + brickOffsetLeft;
                        var brickY = r * (brickHeight + brickPadding) + brickOffsetTop;
                        bricks[c][r].x = brickX;
                        bricks[c][r].y = brickY;
                        ctx.drawImage(brickImage, brickX, brickY, brickWidth, brickHeight);
                    }
                }
            }
        }

        function drawElapsedTime() {
            if (gameStarted) {
                elapsedTime = ((Date.now() - startTime) / 1000).toFixed(2);
                ctx.fillStyle = "white";
                ctx.font = "24px Arial";
                ctx.textAlign = "center";
                ctx.fillText(`ê²½ê³¼ì‹œê°„: ${elapsedTime}ì´ˆ`, canvas.width / 2, canvas.height * 2 / 3);
            }
        }

        function collisionDetection() {
            for (var c = 0; c < brickColumnCount; c++) {
                for (var r = 0; r < brickRowCount; r++) {
                    var b = bricks[c][r];
                    if (b.status == 1) {
                        if (x + dx > b.x && x + dx < b.x + brickWidth && y + dy > b.y && y + dy < b.y + brickHeight) {
                            // ì•„ì´í…œì„ íšë“í•œ ê²½ìš° ë²½ëŒì„ ëš«ê³  ì§€ë‚˜ê°
                            if (!itemCaught) { 
                                var hitFromLeft = x + enlargedBallRadius > b.x && x - enlargedBallRadius < b.x;
                                var hitFromRight = x + enlargedBallRadius > b.x + brickWidth && x - enlargedBallRadius < b.x + brickWidth;
                                var hitFromTop = y + enlargedBallRadius > b.y && y - enlargedBallRadius < b.y;
                                var hitFromBottom = y + enlargedBallRadius > b.y + brickHeight && y - enlargedBallRadius < b.y + brickHeight;
        
                                if (hitFromLeft || hitFromRight) {
                                    dx = -dx;
                                }
                                if (hitFromTop || hitFromBottom) {
                                    dy = -dy;
                                }
                            }
                            
                            b.status = 0;
                            score++;
                            if (score == brickRowCount * brickColumnCount) {
                                gameStarted = false;
                                drawSuccessMessage();
                            }

                            // ì•„ì´í…œì´ ë‚™í•˜ ì¤‘ì´ ì•„ë‹ˆê³ , itemStockì´ falseì¼ ë•Œë§Œ ìƒˆë¡œìš´ ì•„ì´í…œ ìƒì„±
                            if (!itemFalling && !itemStock) {
                                if (Math.random() < 0.1) {  // ì•„ì´í…œ ë‚™í•˜ë¥¼ ì‹œì‘í•  í™•ë¥  (ì˜ˆ: 10%)
                                    startItemFall(b.x, b.y);
                                }
                            }
                        }
                    }
                }
            }
        
            if (y + dy > canvas.height - paddleHeight - enlargedBallRadius) {
                if (x > paddleX && x < paddleX + paddleWidth) {
                    var hitPos = (x - paddleX) / paddleWidth;
                    var angle = (hitPos - 0.5) * Math.PI / 2;  // -45ë„ì—ì„œ 45ë„ ì‚¬ì´ì˜ ê°ë„
                    var speed = Math.sqrt(dx * dx + dy * dy) * 1.05; // ì†ë„ ì•½ê°„ ì¦ê°€
        
                    dx = speed * Math.sin(angle);
                    dy = -speed * Math.cos(angle);
        
                    if (difficulty === 'ì–´ë ¤ì›€') {
                        adjustSpeed(10, 19, 40);
                    } else if (difficulty === 'ë„ì „') {
                        adjustSpeed(40, 76, 160); // ìµœì†Œ ë° ìµœëŒ€ ì†ë„ë¥¼ ì–´ë ¤ì›€ì˜ 4ë°°ë¡œ ì„¤ì •
                    } else {
                        adjustSpeed(5, 7, 0); // ì‰¬ì›€ ë‚œì´ë„ì—ì„œëŠ” ì†ë„ë¥¼ ì¤„ì´ê³  ê°ë„ ë³€ê²½ì„ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                    }
        
                    y = canvas.height - paddleHeight - enlargedBallRadius;
                } else if (y + dy > canvas.height - enlargedBallRadius) {
                    gameStarted = false;
                    document.getElementById("startMessage").style.display = "block";
                    successMessageShown = true;
                    return;
                }
            }
        }




        
        function adjustSpeed(minSpeed, maxSpeed, randAngleRange) {
            if (randAngleRange > 0) {
                var randAngle = (Math.random() - 0.5) * randAngleRange;
                dx += randAngle;
            }
        
            var angle = Math.atan2(dy, dx);
            var minAngle = Math.PI / 6;
        
            if (Math.abs(angle) < minAngle) {
                if (angle < 0) {
                    angle = -minAngle;
                } else {
                    angle = minAngle;
                }
                var speed = Math.sqrt(dx * dx + dy * dy);
                dx = speed * Math.cos(angle);
                dy = speed * Math.sin(angle);
            }
        
            var speed = Math.sqrt(dx * dx + dy * dy);
            if (speed < minSpeed || speed > maxSpeed) {
                var randomSpeed = minSpeed + Math.random() * (maxSpeed - minSpeed);
                dx = (dx / speed) * randomSpeed;
                dy = (dy / speed) * randomSpeed;
            }
        }


        function startGame() {
            // ì°¸ì—¬ íšŸìˆ˜ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ê°€ì ¸ì˜´
            let participationCount = localStorage.getItem('participationCount');
            
            if (!participationCount) {
                participationCount = 0;
            }
            
            participationCount++;
            
            // ì°¸ì—¬ íšŸìˆ˜ë¥¼ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('participationCount', participationCount);
        
            // ì°¸ì—¬ íšŸìˆ˜ë¥¼ êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë¡œ ë°œì†¡
            sendParticipationCount();
                
            document.getElementById("fallingItem").style.display = "none";
            document.getElementById("gameDescription").style.display = 'none';
            document.getElementById("formContainer").style.display = "none";
            document.getElementById("gameCanvas").style.display = "block";
            document.getElementById("rankingBoard").style.display = "none";
            document.getElementById("startMessage").style.display = "none";
            document.getElementById("startButton").style.display = "none";
            document.getElementById('characterSelection').style.display = 'none';
            document.getElementById('difficultySelection').style.display = 'none';
            document.getElementById('rankmore').style.display = 'none';

            var company = document.getElementById("company").value;
            var employeeId = document.getElementById("employeeId").value;
            var name = document.getElementById("name").value;
            localStorage.setItem("company", company);
            localStorage.setItem("employeeId", employeeId);
            localStorage.setItem("name", name);

            itemCaught = false; // íŠ¹ìˆ˜ ëª¨ë“œ ì´ˆê¸°í™”
            
            initGame();
            gameStarted = true;
            startTime = Date.now();
            draw();
        }


        function sendParticipationCount() {
            fetch('https://script.google.com/macros/s/AKfycbwB7eQjvbIeCvQhrSBs8-bPOdETzdGoL2ttTOhEE0kHKjiVgRpDPl66ky44lyJOsN5X/exec', {
                method: 'POST',
                headers: {
                    "Content-Type": "application/json;charset=utf-8",
                },
                body: JSON.stringify({action: 'increment'}),
                mode: 'no-cors'  // no-cors ëª¨ë“œë¡œ ìš”ì²­ ë³´ë‚´ê¸°
            })
            .then(response => {
                console.log('Participation count sent successfully');
            })
            .catch((error) => {
                console.error('Error sending participation count:', error);
            });
        }

        

        

        function draw() {
            if (!gameStarted) return;
        
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawBricks();
            drawBall();
            drawPaddle();
            drawElapsedTime();
            updateItemFall(); // ì•„ì´í…œ ë‚™í•˜ ì—…ë°ì´íŠ¸
            collisionDetection();
                
            if (x + dx > canvas.width - enlargedBallRadius || x + dx < enlargedBallRadius) {
                dx = -dx;
            }
            if (y + dy < enlargedBallRadius) {
                dy = -dy;
            } else if (y + dy > canvas.height - enlargedBallRadius) {
                if (x > paddleX - enlargedBallRadius && x < paddleX + paddleWidth + enlargedBallRadius) {
                    dy = -dy;
                    y = canvas.height - paddleHeight - enlargedBallRadius;
                } else {
                    gameOver();
                    return;
                }
            }
        
            if (rightPressed && paddleX < canvas.width - paddleWidth) {
                paddleX += 7;
            } else if (leftPressed && paddleX > 0) {
                paddleX -= 7;
            }
        
            x += dx;
            y += dy;
        
            if (gameStarted) {
                requestAnimationFrame(draw);
            }
        }

        function gameOver() {
            gameStarted = false;
            document.getElementById("startMessage").style.display = "block";
            document.getElementById("exit").style.display = "block";
            // ì¶”ê°€ì ìœ¼ë¡œ ê²Œì„ ì˜¤ë²„ ë©”ì‹œì§€ë¥¼ ë„ìš°ê³  í•„ìš”í•œ ë™ì‘ì„ ìˆ˜í–‰
        }

        
        function sendToGoogleSheets() {
            var company = document.getElementById("company").value.trim();
            var employeeId = document.getElementById("employeeId").value.trim();
            var name = document.getElementById("name").value.trim();
            
            // ì…ë ¥ í•„ë“œê°€ ë¹„ì–´ìˆëŠ”ì§€ í™•ì¸
            if (company === "" || employeeId === "" || name === "") {
                alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”."); // ê²½ê³  ë©”ì‹œì§€ í‘œì‹œ
                return; // í•¨ìˆ˜ ì¢…ë£Œ
            }
        
            var elapsedTime = localStorage.getItem("elapsedTime");
            var participationTime = new Date().toLocaleString(); // ì°¸ì—¬ ì‹œê°„ ìƒì„±
        
            // ê¸°ì¡´ì— ì„ íƒëœ ë‚œì´ë„(difficulty)ë¥¼ ê°€ì ¸ì˜´
            var selectedDifficulty = difficulty; // ì´ë¯¸ ì „ì—­ë³€ìˆ˜ë¡œ ì„¤ì •ëœ ë‚œì´ë„ ê°’ì„ ì‚¬ìš©
        
            var data = {
                company: company,
                employeeId: employeeId,
                name: name,
                elapsedTime: elapsedTime,
                participationTime: participationTime, // ì°¸ì—¬ ì‹œê°„ ì¶”ê°€
                difficulty: selectedDifficulty // ì„ íƒëœ ë‚œì´ë„ë¥¼ ë°ì´í„°ì— ì¶”ê°€
            };
        
            // ë¡œë”© ìŠ¤í¬ë¦° í‘œì‹œ
            showLoadingScreen();            
        
            // ë­í‚¹ ë³´ë“œì˜ ìœ„ì¹˜ë¥¼ ìœ„ë¡œ ì˜¬ë¦¬ê¸°
            var rankingBoard = document.getElementById("rankingBoard");
            rankingBoard.style.position = "absolute"; // ìœ„ì¹˜ ì„¤ì •ì„ ìœ„í•´ position ì†ì„± ì¶”ê°€
            rankingBoard.style.top = "30%"; // ë­í‚¹ ë³´ë“œë¥¼ í™”ë©´ì—ì„œ 30% ìœ„ì¹˜ë¡œ ì´ë™       
            document.getElementById("rankmore").style.display = "block";
                        
            fetch('https://script.google.com/macros/s/AKfycbzFJQwTMNssXrzPP-B85taN0uL3lJajYrXqf7mokzBLbPu88UmTgVzNN6YvFH2jY26Ctw/exec', {
                method: 'POST',
                headers: {
                    "Content-Type": "text/plain;charset=utf-8",
                },
                body: JSON.stringify(data),
                mode: 'cors'
            })
            .then(response => {
                if (response.ok) {
                    console.log('Google Sheets ì „ì†¡ ì„±ê³µ:', response);
                    alert('ì´ë²¤íŠ¸ ì‘ëª¨ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    console.error('Google Sheets ì „ì†¡ ì—ëŸ¬:', response);
                    alert('ì´ë²¤íŠ¸ ì‘ëª¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch((error) => {
                console.error('Google Sheets ì „ì†¡ ì—ëŸ¬:', error);
                alert('ì´ë²¤íŠ¸ ì‘ëª¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            })
            .finally(() => {
                saveLocalRanking(data);
        
                gamecount++; // ê²Œì„ ì¹´ìš´íŠ¸ ì¦ê°€
                console.log('Game count:', gamecount);
                
                // í¼ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById("company").value = "";
                document.getElementById("employeeId").value = "";
                document.getElementById("name").value = "";
        
                // í¼ê³¼ ë©”ì‹œì§€ í‘œì‹œ ì—…ë°ì´íŠ¸
                document.getElementById("formContainer").style.display = "none";
                document.getElementById("message").style.display = "block";
        
                document.getElementById("gameCanvas").style.display = "none";
                document.getElementById("startMessage").style.display = "block";
                document.getElementById("exit").style.display = "block";
                
                // 4ì´ˆ ë”œë ˆì´ í›„ ë¡œë”© ìŠ¤í¬ë¦° ìˆ¨ê¸°ê³  ë­í‚¹ ë³´ë“œ í‘œì‹œ
                setTimeout(() => {
                    hideLoadingScreen();
                    showMessage(true);
                    displayLocalRankingBoard();
                }, 4000); // 4000 ë°€ë¦¬ì´ˆ = 4ì´ˆ
            });
        }



        function getLocalRankings() {
            var rankings = JSON.parse(localStorage.getItem('rankings')) || [];
            return rankings;
        }

        function saveLocalRanking(newEntry) {
            var rankings = getLocalRankings();
            rankings.push(newEntry);
            rankings.sort(function(a, b) {
                return a.elapsedTime - b.elapsedTime;
            });
            rankings = rankings.slice(0, 5);
            localStorage.setItem('rankings', JSON.stringify(rankings));
        }

        
        function displayLocalRankingBoard() {
            // ë¡œë”© í™”ë©´ì„ í‘œì‹œ
            var loadingScreen2 = document.getElementById("loadingScreen2");
            loadingScreen2.style.display = "flex";
            
            fetch('https://script.google.com/macros/s/AKfycbzFJQwTMNssXrzPP-B85taN0uL3lJajYrXqf7mokzBLbPu88UmTgVzNN6YvFH2jY26Ctw/exec', {
                mode: 'cors'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log(data); // ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•˜ì—¬ í™•ì¸í•©ë‹ˆë‹¤.
        
                var rankingBoard = document.getElementById("rankingBoard");
                rankingBoard.style.display = "block";
                rankingBoard.innerHTML = "<h2>ğŸ†ê²Œì„ ë­í‚¹ğŸ†</h2>";
                
                // 'result' ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ì—¬ ìƒìœ„ 10ê°œ ë­í‚¹ì„ í‘œì‹œí•©ë‹ˆë‹¤.
                data.result.forEach((entry, index) => {
                    var entryElement = document.createElement("div");
                    entryElement.className = "rank";
                    var rankText = `${entry.name} (${entry.employeeId}) - ${entry.elapsedTime.toFixed(2)}ì´ˆ ${entry.difficulty || 'N/A'}`;
                    
                    if (index === 0) {
                        entryElement.innerHTML = `<span class="name" style="font-weight:bold; color: gold;">1ë“±ğŸ¥‡ ${rankText}</span>`;
                    } else if (index === 1) {
                        entryElement.innerHTML = `<span class="name" style="font-weight:bold; color: silver;">2ë“±ğŸ¥ˆ ${rankText}</span>`;
                    } else if (index === 2) {
                        entryElement.innerHTML = `<span class="name" style="font-weight:bold; color: bronze;">3ë“±ğŸ¥‰ ${rankText}</span>`;
                    } else {
                        entryElement.innerHTML = `<span class="name">${index + 1}ë“±ğŸ™„ ${rankText}</span>`;
                    }
        
                    rankingBoard.appendChild(entryElement);
                });
        
                console.log("ì „ì²´ ìµœê³  ê¸°ë¡:", data.entire);
            })
            .finally(() => {
                // ë¡œë”© í™”ë©´ì„ ìˆ¨ê¹€
                loadingScreen2.style.display = "none";
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                // ë¡œë”© í™”ë©´ì„ ìˆ¨ê¹€ (ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„)
                loadingScreen2.style.display = "none";
            });
        }



        function rankmore() {
            // íŒì—… ì°½ ì—´ê¸°
            var popup = window.open("", "RankPopup", "width=600,height=800");
        
            // íŒì—… ì°½ì— HTML êµ¬ì¡° ì¶”ê°€
            popup.document.write(`
                <html>
                <head>
                    <title>ì „ì²´ ë­í‚¹</title>
                    <style>
                        body {
                            font-family: 'Nanum Gothic', 'Malgun Gothic', sans-serif;
                            background-color: #f9f9f9;
                            text-align: center;
                            overflow-y: auto; /* ìŠ¤í¬ë¡¤ë°”ê°€ í•„ìš”í•  ê²½ìš° ìƒì„± */
                        }
                        #rankingBoard {
                            margin: 20px auto;
                            padding: 20px;
                            border-radius: 10px;
                            background-color: rgba(255, 255, 0, 0.5);
                            color: black;
                            font-weight: bold;
                            line-height: 1.6;
                            width: 80%;
                            max-width: 500px;
                        }
                        .rank {
                            margin: 10px 0;
                        }
                        h2 {
                            color: #333;
                        }
                    </style>
                </head>
                <body>
                    <h2>ğŸ†ì „ì²´ ë­í‚¹ğŸ†</h2>
                    <div id="rankingBoard"></div>
                </body>
                </html>
            `);
        
            // ë¡œë”© í™”ë©´ì„ í‘œì‹œ
            var loadingScreen2 = document.getElementById("loadingScreen2");
            loadingScreen2.style.display = "flex";
            
            fetch('https://script.google.com/macros/s/AKfycbzFJQwTMNssXrzPP-B85taN0uL3lJajYrXqf7mokzBLbPu88UmTgVzNN6YvFH2jY26Ctw/exec', {
                mode: 'cors'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log(data); // ë°›ì•„ì˜¨ ë°ì´í„°ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•˜ì—¬ í™•ì¸í•©ë‹ˆë‹¤.
        
                var rankingBoard = popup.document.getElementById("rankingBoard");
        
                // 'entire' ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ì—¬ ì „ì²´ ë­í‚¹ì„ í‘œì‹œí•©ë‹ˆë‹¤.
                data.entire.forEach((entry, index) => {
                    var entryElement = popup.document.createElement("div");
                    entryElement.className = "rank";
                    entryElement.innerHTML = `<span class="name">${index + 1}ë“± ${entry.name} (${entry.employeeId})</span><span class="time">${entry.elapsedTime.toFixed(2)}ì´ˆ ${entry.difficulty}</span>`;
                    rankingBoard.appendChild(entryElement);
                });
            })
            .finally(() => {
                // ë¡œë”© í™”ë©´ì„ ìˆ¨ê¹€
                loadingScreen2.style.display = "none";
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                // ë¡œë”© í™”ë©´ì„ ìˆ¨ê¹€ (ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„)
                loadingScreen2.style.display = "none";
            });
        }


        function showMessage(success = false) {
            var messageElement = document.getElementById('message');
            
            if (success) {
                messageElement.classList.add('success-drawn');
            } else {
                messageElement.classList.remove('success-drawn');
            }
        
            messageElement.style.display = 'block';
            messageElement.innerText = success ? "ì„±ê³µ! ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤." : "ì¼ë°˜ ë©”ì‹œì§€ ë‚´ìš©";
        }
        

    </script>
</body>
</html>
